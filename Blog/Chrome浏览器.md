---
title: Chrome浏览器
type: categories
copyright: true
date: 2020-05-25 21:15:07
tags: 浏览器
categories: 浏览器
---

### 前言
今天面了一个试，暴露出了很多问题，感觉自己有些知识建立在虚无缥缈之上，没有根基，也不连贯，还是需要多总结和学习。
面试官问了一下chrome的进程和线程，自己是凭感觉回答的，天天和chrome打交道，却不太了解有点不行，需要好好的学习一个。

### 浏览器结构
1. 用户界面
2. 浏览器引擎
3. 渲染引擎（Webkit，Blink，Trident）
4. 网络模块
5. js引擎（V8）
6. 界面后端
7. 数据存储

### 多进程架构浏览器
Chrome浏览器使用多个进程来隔离不同的网页。因此在Chrome中打开一个网页相当于起了一个进程。
原因第一是安全，因为进程间不会共享资源和地址空间，而线程之间有可能会恶意修改或者获取非授权数据等复杂的安全问题。
原因第二是把所有网页都放进一个进程的浏览器面临在健壮性，响应速度，安全性方面的挑战，一个tab崩，浏览器全崩

### Chrome的进程
打开chrome的任务管理器可以发现，他有很多进程
1. 浏览器进程，占用CPU最多，控制chrome应用程序，包括地址栏，书签，后退和前进按钮等，还有权限管理例如网络请求和文件访问
2. 渲染器进程，控制选项卡内，网站里显示的全部内容
3. 插件进程，chrome的插件，比如flash
4. GPU进程，专门用来处理GPU任务
5. 扩展进程，执行的各种应用插件，例如掘金
6. 标签页进程，每一个标签页也是一个进程
7. 实用进程，比如网络或者声音

### Chrome内核（渲染进程）的多线程
浏览器内核是通过取得页面内容、整理信息（应用CSS）、计算和组合最终输出可视化的图像结果，通常也被称为渲染引擎。每个tab网页都有由其独立的渲染引擎实例。
1. GUI渲染线程，负责渲染html元素，当需要重绘或者回流时执行，js引擎会导致GUI引擎挂起，也就是冻结
2. js引擎线程，解析js脚本，运行代码
3. 定时触发器线程，因为js是单线程，如果处于阻塞状态会影响计时的准确，因此需要单独的线程进行计时
4. 事件触发线程，事件被触发时，事件线程会把事件添加到待处理事件的队尾，等待js引擎的处理。
5. 异步http请求线程，在XMLHttpRequest在连接后是通过浏览器新开一个线程请求， 将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件放到 JavaScript引擎的处理队列中等待处理。

**js引擎与GUI线程是互斥的**：因为js可以操作dom，如果修改的同时渲染界面，那么渲染线程前后获得的元素数据就不一样。
所以当js执行时，gui会被挂起，gui更新会被保存到一个队列里，等引擎线程空闲时立即被执行。
所以JS执行的时间过长，就会造成页面的渲染不连贯。





